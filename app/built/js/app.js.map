{"version":3,"sources":["app.js"],"names":["choosableColors","YlGn","GnBu","BuPu","PuRd","RdPu","YlOrRd","baseColors","Pu","Bu","Gn","Or","Rd","colors","chooseRandomFromArray","arr","Math","floor","random","length","chooseRandomFromObject","obj","Object","keys","leftPad","str","pad","len","Array","join","getGradient","fromClr","toClr","numStops","stops","slice","map","x","parseInt","i","f","k","toString","wrapText","text","el","SVG","words","split","line","lineHeight","svg","document","createElementNS","textNode","tspan","width","ceil","getBoundingClientRect","builder","dy","word","setAttributeNS","appendChild","shift","push","textContent","getComputedTextLength","pop","removeChild","trianglify","colorSet","animate","cell_size","maskId","getAttribute","querySelector","height","canvas","createElement","ctx","getContext","Trianglify","variance","polys","templ","className","fading","defaultNumStops","lastTimestamp","chosenColors","changeColorSet","set","a","indexOf","clr","p","fillStyle","strokeStyle","beginPath","moveTo","apply","lineTo","fill","stroke","randClr","lineWidth","style","position","childNodes","n","insertAdjacentHTML","animFrame","timestamp","stop","clrStops","requestAnimationFrame","chosenRandClr","titleCanvas","changeTitleColorSet","window","onload","querySelectorAll","color","onclick"],"mappings":"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","file":"app.js","sourcesContent":["(() => {\r\n  // Colours from ColorBrewer\r\n  // https://bl.ocks.org/mbostock/5577023\r\n  const choosableColors = {\r\n    YlGn: [\"#addd8e\",\"#78c679\",\"#41ab5d\",\"#238443\"],\r\n    GnBu: [\"#7bccc4\",\"#4eb3d3\",\"#2b8cbe\",\"#0868ac\"],\r\n    BuPu: [\"#8c96c6\",\"#8c6bb1\",\"#88419d\",\"#810f7c\"],\r\n    PuRd: [\"#e7298a\",\"#ce1256\",\"#980043\",\"#67001f\"],\r\n    RdPu: [\"#f768a1\",\"#dd3497\",\"#ae017e\",\"#7a0177\"],\r\n    YlOrRd: [\"#feb24c\",\"#fd8d3c\",\"#fc4e2a\",\"#e31a1c\"]\r\n  }\r\n  const baseColors = {\r\n    Pu: [\"#807dba\",\"#6a51a3\",\"#54278f\",\"#3f007d\"],\r\n    Bu: [\"#4292c6\",\"#2171b5\",\"#08519c\",\"#08306b\"],\r\n    Gn: [\"#41ab5d\",\"#238b45\",\"#006d2c\",\"#00441b\"],\r\n    Or: [\"#f16913\",\"#d94801\",\"#a63603\",\"#7f2704\"],\r\n    Rd: [\"#ef3b2c\",\"#cb181d\",\"#a50f15\",\"#67000d\"]\r\n  };\r\n  const colors = { ...choosableColors, ...baseColors };\r\n\r\n  const chooseRandomFromArray = (arr) => arr[Math.floor(Math.random()*arr.length)];\r\n\r\n  const chooseRandomFromObject = (obj) => obj[chooseRandomFromArray(Object.keys(obj))];\r\n\r\n  const leftPad = (str, pad, len) => str.length < len ? (new Array(len - str.length + 1).join(pad) + str) : str;\r\n\r\n  const getGradient = (fromClr, toClr, numStops) => {\r\n    let stops = new Array(numStops);\r\n    \r\n    fromClr = fromClr.slice(1);\r\n    toClr = toClr.slice(1);\r\n\r\n    if (fromClr.length === 6) {\r\n      fromClr = [fromClr.slice(0, 2), fromClr.slice(2, 4), fromClr.slice(4)].map((x) => parseInt(x, 16));\r\n    } else {\r\n      fromClr = [fromClr[0], fromClr[1], fromClr[2]].map((x) => 17 * parseInt(x, 16));\r\n    }\r\n    if (toClr.length === 6) {\r\n      toClr = [toClr.slice(0, 2), toClr.slice(2, 4), toClr.slice(4)].map((x) => parseInt(x, 16));\r\n    } else {\r\n      toClr = [toClr[0], toClr[1], toClr[2]].map((x) => 17 * parseInt(x, 16));\r\n    }\r\n\r\n    for (let i=0; i<stops.length; i++) {\r\n      stops[i] = '#' + fromClr.map((f, k) => leftPad(Math.floor(f + (i + 1) * (toClr[k] - f) / numStops).toString(16), 0, 2)).join('');\r\n    }\r\n\r\n    return stops;\r\n  };\r\n    \r\n  // wrap text to constraints of el\r\n  // returns a SVG string\r\n  // inspired by https://bl.ocks.org/mbostock/7555321\r\n  let wrapText = (text, el) => {\r\n    const SVG = \"http://www.w3.org/2000/svg\";\r\n    let words = text.split(/\\s/),\r\n        line = [],\r\n        lineHeight = 1,\r\n        svg = document.createElementNS(SVG, 'svg'),\r\n        textNode = document.createElementNS(SVG, 'text'),\r\n        tspan = document.createElementNS(SVG, 'tspan'),\r\n        width = Math.ceil(el.getBoundingClientRect().width), // give some wiggle room\r\n        builder = [],\r\n        dy = 0.95,\r\n        word;\r\n    \r\n    tspan.setAttributeNS(SVG, 'x', 0);\r\n    tspan.setAttributeNS(SVG, 'y', 0);\r\n    textNode.appendChild(tspan);\r\n    svg.appendChild(textNode);\r\n    el.appendChild(svg);\r\n    \r\n    while (word = words.shift()) {\r\n      line.push(word);\r\n      tspan.textContent = line.join(' ');\r\n      if (tspan.getComputedTextLength() > width) {\r\n        line.pop();\r\n        builder.push(`<tspan x=\"0\" y=\"0\" dy=\"${dy}em\">${line.join(' ')}</tspan>`);\r\n        line = [word];\r\n        dy += lineHeight;\r\n      }\r\n    }\r\n    builder.push(`<tspan x=\"0\" y=\"0\" dy=\"${dy}em\">${line.join(' ')}</tspan>`);\r\n    \r\n    el.removeChild(svg);\r\n    \r\n    return builder.join('');\r\n  };\r\n\r\n  let trianglify = (el, colorSet, animate = false, cell_size = 32) => {\r\n    let text = el.textContent,\r\n        maskId = 'mask-' + el.getAttribute('id'),\r\n        { width, height } = el.querySelector('.text-wrap').getBoundingClientRect(),\r\n        canvas = document.createElement('canvas'),\r\n        ctx = canvas.getContext('2d'),\r\n        { polys } = Trianglify({\r\n          width,\r\n          height,\r\n          cell_size, //Math.floor(parseInt(window.getComputedStyle(el, null).fontSize) / 4),\r\n          variance: .69\r\n        }),\r\n        templ = `<span class=\"trianglify-text\" style=\"width:${width}px;height:${height}px\">\r\n    <svg class=\"trianglify-svg\" xmlns=\"http://www.w3.org/2000/svg\">\r\n      <defs>\r\n        <mask id=\"${maskId}\" x=\"0\" y=\"0\" width=\"100%\" height=\"100%\">\r\n          <rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\"></rect>\r\n          <text class=\"${el.className}\" x=\"0\" y=\"0\" dy=\".95em\">${wrapText(text, el.querySelector('.text-wrap'))}</text>\r\n        </mask>\r\n      </defs>\r\n      <rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"white\" mask=\"url(#${maskId})\"/>\r\n  </span>`,\r\n        fading = [],\r\n        defaultNumStops = 75, // 4500 / 60; each change takes 4.5 seconds\r\n        lastTimestamp = 0, // for animation\r\n        chosenColors;\r\n    \r\n    let changeColorSet = (set) => {\r\n      chosenColors = set;\r\n      polys = polys.map((a) => [chosenColors.indexOf(chooseRandomFromArray(chosenColors)), a[1]]);\r\n      fading = new Array(polys.length);\r\n\r\n      for (let i=0; i<polys.length; i++) {\r\n        let [clr, p] = polys[i];\r\n        ctx.fillStyle = ctx.strokeStyle = chosenColors[clr];\r\n        ctx.beginPath();\r\n        ctx.moveTo.apply(ctx, p[0]);\r\n        ctx.lineTo.apply(ctx, p[1]);\r\n        ctx.lineTo.apply(ctx, p[2]);\r\n        ctx.fill();\r\n        ctx.stroke();\r\n        \r\n        if (Math.random() < 0.1) {\r\n          let randClr = chooseRandomFromArray(chosenColors);\r\n          fading[i] = [0, getGradient(chosenColors[clr], randClr, defaultNumStops), p];\r\n          polys[i][0] = chosenColors.indexOf(randClr);\r\n        }\r\n      }\r\n    };\r\n      \r\n    ctx.lineWidth = 0.0001;\r\n\r\n    el.style.position = 'relative';\r\n    el.style.height = height + 'px';\r\n    el.style.width = width + 'px';\r\n    \r\n    canvas.width = width - 2;\r\n    canvas.height = height - 2;\r\n    canvas.className = 'trianglify-canvas';\r\n    \r\n    changeColorSet(colorSet);\r\n    \r\n    for (let n of el.childNodes) {\r\n      el.removeChild(n);\r\n    }\r\n    \r\n    el.insertAdjacentHTML('beforeend', templ);\r\n    el.appendChild(canvas);\r\n    \r\n    if (animate) {\r\n      let animFrame = (timestamp) => {\r\n        // randomly fade a few polygons\r\n        for (let i=0; i<fading.length; i++) {\r\n          if (!fading[i]) continue;\r\n          let [stop, clrStops, p] = fading[i];\r\n          ctx.fillStyle = ctx.strokeStyle = clrStops[stop];\r\n          ctx.beginPath();\r\n          ctx.moveTo.apply(ctx, p[0]);\r\n          ctx.lineTo.apply(ctx, p[1]);\r\n          ctx.lineTo.apply(ctx, p[2]);\r\n          ctx.fill();\r\n          ctx.stroke();\r\n\r\n          if (stop + 1 < clrStops.length)\r\n            fading[i][0] = stop + 1;\r\n          else\r\n            delete fading[i];\r\n        }\r\n\r\n        // every 1/2 second, fade a few more\r\n        if (timestamp - lastTimestamp > 500) {\r\n          for (let i=0; i<polys.length; i++) {\r\n            let [clr, p] = polys[i];\r\n            if (!!fading[i]) continue;\r\n            if (Math.random() < 0.03) {\r\n              let randClr = chooseRandomFromArray(chosenColors);\r\n              fading[i] = [0, getGradient(chosenColors[clr], randClr, defaultNumStops), p];\r\n              polys[i][0] = chosenColors.indexOf(randClr);\r\n            }\r\n          }\r\n\r\n          lastTimestamp = timestamp;\r\n        }\r\n\r\n        return requestAnimationFrame(animFrame);\r\n      };\r\n      \r\n      animFrame(0);\r\n    }\r\n    \r\n    return {\r\n      canvas,\r\n      changeColorSet\r\n    };\r\n  }\r\n\r\n  let chosenRandClr = chooseRandomFromObject(choosableColors), titleCanvas, changeTitleColorSet;\r\n  window.onload = () => {\r\n    let { canvas, changeColorSet } = trianglify(document.querySelector('#title'), chosenRandClr, true);\r\n    titleCanvas = canvas;\r\n    changeTitleColorSet = changeColorSet;\r\n    \r\n    for (let a of document.querySelectorAll('#site-header .subtitle a'))\r\n      a.style.color = chosenRandClr[3];\r\n    document.querySelector('#title').onclick = () => {\r\n      chosenRandClr = chooseRandomFromObject(choosableColors);\r\n      changeTitleColorSet(chosenRandClr);\r\n      for (let a of document.querySelectorAll('#site-header .subtitle a'))\r\n        a.style.color = chosenRandClr[3];\r\n    };\r\n\r\n    trianglify(document.querySelector('#about-heading'), colors.Or);\r\n    trianglify(document.querySelector('#portfolio-heading'), colors.Rd);\r\n    trianglify(document.querySelector('#blog-heading'), colors.Bu);\r\n    trianglify(document.querySelector('#contact-heading'), colors.Gn);\r\n  };\r\n})();"]}